# ~/.bashrc - sourced every time a terminal is opened

# start wm if tty is tty1
if [ $(tty) = /dev/tty1 ]; then startx exit 0; fi 

# show all entries & colourze output
# [Bug]: System alias ll='ls -l --color=auto' with aliases completion enabled breaks bash file/directory tab completion behavior #2174
# https://github.com/Bash-it/bash-it/issues/2174
alias ls='ls -x --color=auto'

# colored grep - Need to check an existing file for a pattern that will be found to ensure
alias grep='grep --color=auto'

alias df='df -h' # make output human readable
alias wget="wget -c" # resume download if interupted
alias update-grub="sudo grub-mkconfig -o /boot/grub/grub.cfg" # update grub

alias size="du -hs" # show total size of directories and files 
alias dcomp="sudo rm config.h && sudo make clean install"  # dwm and dmenu QoL
alias kcomp1="sudo sv restart keyd"
alias kcomp2="xset r rate 200 25"
export $(dbus-launch)
eval "$(jump shell)" # https://github.com/gsamokovarov/jump

# insert a new line only when the last command output doesn't have one
# https://unix.stackexchange.com/a/647881
# https://github.com/dylanaraps/pure-bash-bible#get-the-current-cursor-position
# https://stackoverflow.com/a/52944692/520567
NEW_LINE() {
    local _ y x _
    local LIGHT_YELLOW="\001\033[1;93m\002"
    local     RESET="\001\e[0m\002"

    IFS='[;' read -p $'\e[6n' -d R -rs _ y x _
    if [[ "$x" != 1 ]]; then
        # printf "\n${LIGHT_YELLOW}^ missing newline (\\\n) at end of output\n${RESET}"
        printf "\n${RESET}"
    fi
}
BG='\[$(tput sgr0)\]'       # ┌──()-[] └─$          # reset all attributes 
FG1='\[$(tput setaf 9)\]'   # local@notebook        # foreground color
FG2='\[$(tput setaf 10)\]'  # ~/projects/           # foreground color
export PROMPT_DIRTRIM=3
export PS1="\$(NEW_LINE)${BG}┌──[${FG1}\u@\h${BG}]${BG}[${FG2}\w${BG}]\n└─$ " # bash prompt v2

[[ $PS1 && -f /usr/share/bash-completion/bash_completion ]] && source /etc/profile.d/bash_completion.sh # Use bash-completion, if available
bind "set completion-ignore-case on" # ignore upper and lowercase when TAB completion
 
# fzf keybindings - alt+c ctrl+t etc.
# if [ -x "$(command -v fzf)" ]; then
#     source /usr/share/fzf/key-bindings.bash
# fi
 
# export BASH_IT="/home/local/.bash_it" # Path to the bash it configuration
# export BASH_IT_THEME="" # disable bash-it themes
# export BASH_IT_PROJECT_PATHS="${HOME}/projects" # Set this to the location of your work or project folders
# unset MAILCHECK # Don't check mail when opening terminal.
# export SCM_CHECK=false # Set this to false to turn off version control status checking within the prompt for all themes
# source "$BASH_IT"/bash_it.sh # Load Bash It
